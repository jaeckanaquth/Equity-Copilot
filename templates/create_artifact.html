<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if form_mode == 'belief' %}Add Belief{% elif form_mode == 'question' %}Add Question{% else %}Add Belief or Question{% endif %} — Equity Copilot</title>
    <style>
        :root {
            --bg: #fafaf9;
            --surface: #ffffff;
            --border: #e5e5e4;
            --text: #1c1917;
            --accent: #2563eb;
        }
        * { box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); max-width: 640px; margin: 0 auto; padding: 2rem; }
        h1 { font-size: 1.5rem; margin-bottom: 1.5rem; }
        a { color: var(--accent); }
        .form-block { margin-bottom: 1.5rem; }
        label { display: block; font-weight: 500; margin-bottom: 0.25rem; }
        textarea { width: 100%; min-height: 80px; padding: 0.5rem; border: 1px solid var(--border); border-radius: 4px; font: inherit; }
        .snapshots { max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 4px; padding: 0.5rem; background: var(--surface); }
        .snapshots label { font-weight: normal; display: flex; align-items: center; gap: 0.5rem; padding: 0.25rem 0; }
        .snapshots input[type="checkbox"] { margin: 0; }
        button[type="submit"] { background: var(--accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font: inherit; }
        button[type="submit"]:hover { opacity: 0.9; }
        .section { background: var(--surface); border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; margin-bottom: 1.5rem; }
        .section h2 { font-size: 1rem; margin: 0 0 1rem; }
        .risk-option { margin-top: 0.5rem; }
        .risk-option label { display: inline; font-weight: normal; }
        .add-all-row { margin-bottom: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.35rem; }
        .add-all-row button { font-size: 0.8rem; padding: 0.35rem 0.6rem; background: var(--surface); color: var(--text); border: 1px solid var(--border); border-radius: 4px; cursor: pointer; }
        .add-all-row button:hover { background: var(--bg); border-color: var(--accent); color: var(--accent); }
    </style>
</head>
<body>
    <h1>{% if form_mode == 'belief' %}Add Belief{% elif form_mode == 'question' %}Add Question{% else %}Add Belief or Question{% endif %}</h1>
    <p>
        <a href="/weekly-review">← Weekly Review</a>
        {% if form_mode == 'both' %}
        · <a href="/beliefs/new">Belief only</a> · <a href="/questions/new">Question only</a>
        {% elif form_mode == 'belief' %}
        · <a href="/questions/new">Add question</a>
        {% elif form_mode == 'question' %}
        · <a href="/beliefs/new">Add belief</a>
        {% endif %}
    </p>

    {% if form_mode == "belief" or form_mode == "both" %}
    <div class="section">
        <h2>Add belief (thesis or risk)</h2>
        <form id="form-belief" action="/api/artifacts/belief" method="post">
            <div class="form-block">
                <label for="belief-statement">Statement</label>
                <textarea id="belief-statement" name="statement" required placeholder="e.g. MSFT cloud growth will decelerate in FY26."></textarea>
            </div>
            <div class="form-block risk-option">
                <input type="checkbox" id="belief-risk" name="risk" value="true">
                <label for="belief-risk">Treat as risk (not thesis)</label>
            </div>
            <div class="form-block">
                <label>Reference snapshots (optional)</label>
                {% if tickers %}
                <div class="add-all-row">Add all for company:
                    {% for ticker in tickers %}
                    <button type="button" class="add-all-company" data-ticker="{{ ticker }}">Add all {{ ticker }}</button>
                    {% endfor %}
                </div>
                {% endif %}
                <div class="snapshots">
                    {% for s in snapshots %}
                    <label><input type="checkbox" name="snapshot_ids" value="{{ s.id }}" data-ticker="{{ s.ticker }}"> {{ s.ticker }} {{ s.as_of }}</label>
                    {% endfor %}
                    {% if not snapshots %}
                    <p style="margin:0;color:#57534e;">No snapshots. <a href="/">Import data</a> first.</p>
                    {% endif %}
                </div>
            </div>
            <button type="submit">Create belief</button>
        </form>
    </div>
    {% endif %}

    {% if form_mode == "question" or form_mode == "both" %}
    <div class="section">
        <h2>Add question</h2>
        <form id="form-question" action="/api/artifacts/question" method="post">
            <div class="form-block">
                <label for="question-statement">Question</label>
                <textarea id="question-statement" name="statement" required placeholder="e.g. What is the margin trajectory for AWS?"></textarea>
            </div>
            <div class="form-block">
                <label>Reference snapshots (optional)</label>
                {% if tickers %}
                <div class="add-all-row">Add all for company:
                    {% for ticker in tickers %}
                    <button type="button" class="add-all-company" data-ticker="{{ ticker }}">Add all {{ ticker }}</button>
                    {% endfor %}
                </div>
                {% endif %}
                <div class="snapshots">
                    {% for s in snapshots %}
                    <label><input type="checkbox" name="snapshot_ids" value="{{ s.id }}" data-ticker="{{ s.ticker }}"> {{ s.ticker }} {{ s.as_of }}</label>
                    {% endfor %}
                    {% if not snapshots %}
                    <p style="margin:0;color:#57534e;">No snapshots. <a href="/">Import data</a> first.</p>
                    {% endif %}
                </div>
            </div>
            <button type="submit">Create question</button>
        </form>
    </div>
    {% endif %}

    <script>
        document.querySelectorAll('.add-all-company').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var form = this.closest('form');
                var ticker = this.getAttribute('data-ticker');
                form.querySelectorAll('input[name=snapshot_ids][data-ticker="' + ticker + '"]').forEach(function(cb) {
                    cb.checked = true;
                });
            });
        });
    </script>
</body>
</html>
